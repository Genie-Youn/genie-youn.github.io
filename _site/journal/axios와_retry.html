<!doctype html>
<html>

<head>

  <title>
    
      Axios와 Retry | 오르막길
    
  </title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <meta property="og:image:secure_url" content="https://user-images.githubusercontent.com/16642635/63559805-66121600-c58e-11e9-989b-3eb58c2a15ef.jpeg" />

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">
  <!-- Use Atom -->
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="오르막길" />
  <!-- Use RSS-2.0 -->
  <!--<link href="/rss-feed.xml" type="application/rss+xml" rel="alternate" title="오르막길 | 잊기전에 기록하기"/>
  //-->

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quattrocento+Sans">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>

  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-146256933-1', 'auto');
  ga('send', 'pageview');
</script>


  <!-- Use Jekyll SEO plugin -->
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Axios와 Retry | 오르막길</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Axios와 Retry" />
<meta name="author" content="genie-youn" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="unsplash-logoAlberto Barrera" />
<meta property="og:description" content="unsplash-logoAlberto Barrera" />
<link rel="canonical" href="http://localhost:4000/journal/axios%EC%99%80_retry.html" />
<meta property="og:url" content="http://localhost:4000/journal/axios%EC%99%80_retry.html" />
<meta property="og:site_name" content="오르막길" />
<meta property="og:image" content="http://localhost:4000/alberto-barrera-G3GL5lJygz8-unsplash.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-24T00:00:00+09:00" />
<script type="application/ld+json">
{"image":"http://localhost:4000/alberto-barrera-G3GL5lJygz8-unsplash.jpg","author":{"@type":"Person","name":"genie-youn"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/journal/axios%EC%99%80_retry.html"},"description":"unsplash-logoAlberto Barrera","@type":"BlogPosting","url":"http://localhost:4000/journal/axios%EC%99%80_retry.html","headline":"Axios와 Retry","dateModified":"2019-10-24T00:00:00+09:00","datePublished":"2019-10-24T00:00:00+09:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


</head>


<body>

  <div class="container">
    <header class="masthead">
  <h3 class="masthead-title">
    <a href="/">오르막길</a>
    <small class="masthead-subtitle">잊기전에 기록하기</small>
    <div class="menu">
  <nav class="menu-content">
    
      <a href="/menu/about.html">About</a>
    
      <a href="/menu/writing.html">Writing</a>
    
  </nav>
  <nav class="social-icons">
    
  
  
    <a href="https://github.com/genie-youn" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a>
  

  
  
    <a href="https://www.linkedin.com/in/%EC%A7%80%EC%88%98-%EC%9C%A4-78921a11b/" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
  

  
  
    <a href="mailto:yjs930915@gmail.com" target="_blank"><i class="fa fa-envelope" aria-hidden="true"></i></a>
  

  </nav>
</div>

  </h3>
</header>


    <div class="post-container">
      <h1>
  Axios와 Retry
</h1>


  <img src="/assets/img/alberto-barrera-G3GL5lJygz8-unsplash.jpg">


<center><small><a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://unsplash.com/@abarro?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Alberto Barrera"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Alberto Barrera</span></a></small></center>

<h1 id="axios와-retry">Axios와 Retry</h1>

<h3 id="들어가며">들어가며</h3>
<p>axios는 실패시 체인의 중간단계에서나 설정을 통한 retry를 제공하지 않는다. 사용자가 직접 구현해 주어야 하는데, 방법은 크게 다음과 같다.</p>

<h3 id="interceptor-활용">Interceptor 활용</h3>
<p>실패시 인터셉터로 잡아 재시도 하는 방법이다. axios 개발팀도 이 방법을 권하고 있다.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">axios</span><span class="p">.</span><span class="nx">interceptors</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">config</span> <span class="o">&amp;&amp;</span> <span class="nx">error</span><span class="p">.</span><span class="nx">response</span> <span class="o">&amp;&amp;</span> <span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">401</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">updateToken</span><span class="p">().</span><span class="nx">then</span><span class="p">((</span><span class="nx">token</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">error</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">xxxx</span> <span class="o">&lt;=</span> <span class="kd">set</span> <span class="nx">the</span> <span class="nx">token</span>
      <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<blockquote>
  <p>참고 https://github.com/axios/axios/issues/934#partial-timeline</p>
</blockquote>

<h3 id="axios-retry-라이브러리-사용">axios-retry 라이브러리 사용</h3>
<p>또 다른 방법은 서드파티 라이브러리인 <code class="highlighter-rouge">axios-retry</code>를 사용하는 방법이다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install </span>axios-retry
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ES6</span>
<span class="k">import</span> <span class="nx">axiosRetry</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">axios-retry</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">axiosRetry</span><span class="p">(</span><span class="nx">axios</span><span class="p">,</span> <span class="p">{</span> <span class="na">retries</span><span class="p">:</span> <span class="mi">3</span> <span class="p">});</span>

<span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://example.com/test</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// The first request fails and the second returns 'ok'</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span> <span class="c1">// 'ok'</span>
  <span class="p">});</span>

<span class="c1">// Exponential back-off retry delay between requests</span>
<span class="nx">axiosRetry</span><span class="p">(</span><span class="nx">axios</span><span class="p">,</span> <span class="p">{</span> <span class="na">retryDelay</span><span class="p">:</span> <span class="nx">axiosRetry</span><span class="p">.</span><span class="nx">exponentialDelay</span><span class="p">});</span>

<span class="c1">// Custom retry delay</span>
<span class="nx">axiosRetry</span><span class="p">(</span><span class="nx">axios</span><span class="p">,</span> <span class="p">{</span> <span class="na">retryDelay</span><span class="p">:</span> <span class="p">(</span><span class="nx">retryCount</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">retryCount</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
<span class="p">}});</span>

<span class="c1">// Works with custom axios instances</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="na">baseURL</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://example.com</span><span class="dl">'</span> <span class="p">});</span>
<span class="nx">axiosRetry</span><span class="p">(</span><span class="nx">client</span><span class="p">,</span> <span class="p">{</span> <span class="na">retries</span><span class="p">:</span> <span class="mi">3</span> <span class="p">});</span>

<span class="nx">client</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/test</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// The first request fails and the second returns 'ok'</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span> <span class="c1">// 'ok'</span>
  <span class="p">});</span>

<span class="c1">// Allows request-specific configuration</span>
<span class="nx">client</span>
  <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/test</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">axios-retry</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">retries</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// The first request fails</span>
    <span class="nx">error</span> <span class="o">!==</span> <span class="kc">undefined</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>사용량도 꽤나 많고, back-off나 재시도 횟수 설정등이 이미 구현되어 있어 편하게 사용할 수 있다는 장점을 갖지만, axios에서 개발한 오피셜한 라이브러리는 아니기때문에 향후 꾸준히 업데이트 될지는 의문이다.</p>


<span class="post-date">
  Written on
  
  October
  24th,
  2019
  by
  
    genie-youn
  
</span>

<div class="post-date">Feel free to share!</div>
  <div class="sharing-icons">
    <a href="https://twitter.com/intent/tweet?text=Axios와 Retry&amp;url=/journal/axios%EC%99%80_retry.html" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=/journal/axios%EC%99%80_retry.html&amp;title=Axios와 Retry" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
    <a href="https://plus.google.com/share?url=/journal/axios%EC%99%80_retry.html" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i></a>
  </div>
</div>


<div class="related">
  <h1 >You may also enjoy:</h1>
  
  <ul class="related-posts">
    
      
        
        
      
        
          <li>
            <h3>
              <a href="/journal/axios%EC%99%80_global_interceptor.html">
                Axios와 Global Interceptor
                <!--<img src="http://localhost:4000/images/">-->
                <!--<small>October 24, 2019</small>-->
              </a>
            </h3>
          </li>
          
        
      
    
  </ul>
</div>



  <section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = "blog-RDzIu87BYM";
    var disqus_identifier = "/journal/axios%EC%99%80_retry.html";
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



    </div>

    <footer class="footer">
  
  
  
    <a href="https://github.com/genie-youn" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a>
  

  
  
    <a href="https://www.linkedin.com/in/%EC%A7%80%EC%88%98-%EC%9C%A4-78921a11b/" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
  

  
  
    <a href="mailto:yjs930915@gmail.com" target="_blank"><i class="fa fa-envelope" aria-hidden="true"></i></a>
  

  <div class="post-date"><a href="/menu/about.html">오르막길 | 잊기전에 기록하기 by genie-youn</a></div>
</footer>

  </div>

</body>
</html>
